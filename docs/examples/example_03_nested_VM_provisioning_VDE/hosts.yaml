all:
  hosts:
    L0-hypervisor:
      ansible_ssh_private_key_file: ~/.ssh/id_rsa
      ansible_connection: ssh
      ansible_host: localhost
      ansible_user: user
      ansible_become_method: enable
      config:
        permutations:
          targets:
            - "amd64"
          platforms:
            - "debian_vs"
    VM debian_vs_amd64:
      ansible_port: 2201
      # https://github.com/ansible/ansible/issues/15402
      # use keys and Jump host to avoid using sshpass and a possibile 'escape of hell' by using nested ProxyCommand
#      ansible_ssh_common_args: >
#        -J {{ hostvars[ hostvars[ 'VM debian_vs_amd64' ].kvm_host ].ansible_user }}@{{ hostvars[ hostvars[ 'VM debian_vs_amd64' ].kvm_host ].ansible_host }}{{ ':' + (hostvars[ hostvars[ 'VM debian_vs_amd64' ].kvm_host ].ansible_port | default('22', true) | string) }}
#        -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no
      # But this will be autogenerated by init_vm_connection role
      config:
        permutations:
          targets:
            - "amd64"
          platforms: 
            - "debian_vs_vde"
            - "debian_vs_user"

    VM debian_vs_user_amd64:
      # Changed port to avoid Ansible jump loop error prevention (it shouldn't happen anyway)
      ansible_port: 2202
  children:
    hypervisors:
      hosts:
        L0-hypervisor:
      # This will be added later by the guest provision phases
      # VM debian_vs_amd64
  vars:
#   should_replace_vm: yes
#   ansible_ssh_args: "-F ./ssh.cfg"
    vde_network: vxvde://234.0.0.1
    

