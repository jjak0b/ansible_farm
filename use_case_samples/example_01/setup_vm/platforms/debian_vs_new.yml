
# Fetch urls and base resource name
# my_root_url : "https://www.cs.unibo.it/~renzo/virtualsquare/daily_brewed/yearly/"
# my_base_image_name: "debian-sid-v2-{{ target_name }}-daily-20220101-874"

- name: Define platform definition
  set_fact:
    vm:
      # metadata properties are used inside a task for installation and setup purposes
      metadata:
        name: "{{ vm.metadata.target_name }} - debian new with virtualsquare pkgs"
        platform_name: debian_vs_new
        hostname: "V2-20221001-1155.{{ vm.metadata.target_name }}.debian_vs_new.vm"
        connection: "qemu:///system"
        auth:
          become_user: &root_user "root"
          become_password: &root_pass "virtualsquare"
          user: "user"
          password: *root_pass
        callbacks:
          sources:
            - before_provision:
              - callbacks/sources/fetch_and_unarchive.yaml
        sources:
        - uri: "https://www.cs.unibo.it/~renzo/virtualsquare/daily_brewed/monthly/debian-sid-v2-{{ vm.metadata.target_name }}-daily-20221001-1155.qcow2.bz2"
          resource_name: "debian-sid-v2-{{ vm.metadata.target_name }}-daily-20221001-1155.qcow2.bz2"
          checksum_uri: "https://www.cs.unibo.it/~renzo/virtualsquare/daily_brewed/monthly/debian-sid-v2-{{ vm.metadata.target_name }}-daily-20221001-1155.qcow2.sha1sum"
          checksum_type: "sha1"
          # fallback checksum value
          checksum_value: "5dfbb9ac0a0ba50214d0eee8b42ea2010e09be33"
          # image name asset_name / processed
          asset_name: &image_file_name "debian-sid-v2-{{ vm.metadata.target_name }}-daily-20221001-1155.qcow2"

      # Others properties are fully custom to templating a custom vm's xml

      # Some properties here, if needed, could override specific architecture values for all architectures
      vcpus: 2
      ram: 2048
      disks:
      - type: "qcow2"
        devname: "hda"
        src: *image_file_name
      net:
        type: network
        source: default-net
        mac: "{{ '52:54:00' | random_mac( seed = 'debian_vs_new_' + vm.metadata.target_name ) }}"
        ip: "10.0.0.6"
        # source: virbr0
